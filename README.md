# jwp-subway-path

## 기능목록

- [x] 노선에 역 등록 API 신규 구현
    - [x] (POST /section) 구역에 새로운 역 추가하는 기능
        - [x] 검증
            - [x] 라인테이블에 라인이 존재하는지 확인 -> 없으면 예외
            - [x] 역 테이블에 두 역이 있는지 확인
        - [x] 구역테이블에 라인이 존재하는 경우
            - [x] 구역 테이블에 새로운 역이 존재 안해야한다 -> 이미 존재 예외
            - [x] 구역 테이블에 해당 라인의 기준역이 존재해야한다. -> 기준역 없음 예외
            - [x] 기준역이 종점인지 확인(역이 속한 구역이 1개면 기준역이 종점)
                - [x] 새로운 역이 종점이 되는 방향인지 확인?
                    - [x] 새로운 역이 종점일 경우
                        - [x] 새로운 구역 추가
                    - [x] 새로운 역이 종점이 아닐 경우
                        - [x] 거리 정보 관리
                            - [x] 해당 방향에 존재하는 구역 거리가 입력 거리보다 큰지 확인
                        - [x] 갈래길 방지
                            - [x] 기존 구역 삭제
                            - [x] 기준역과 새로운역으로 구역 추가
                            - [x] 기준역과 연결되어 있었던 역과 새로운 역으로 구역 추가
        - [x] 구역테이블에 라인이 존재하지 않는 경우 (신규 둥록)
            - [x] 구역 등록한다.

- [x] 노선에 역 제거 API 신규 구현
  - [x] (Delete /section) - 구역에 기존역을 제거하는 기능
      - [x] 해당 라인에 삭제할 역이 존재하지 않으면 예외
      - [x] 해당 라인에 삭제할 역을 포함한 구역이 한개인 경우
          - [x] 종점 제거
      - [x] 해당 라인에 삭제할 역을 포함한 구역이 두개인 경우
          - [x] 재배치
        
- [x] 노선 조회 API 수정
    - [x] (GET /lines/{id}/stations)
        - [x] 노선에 포함된 역을 순서대로 보여주도록 응답을 반환한다.
            - [x] 상행 종점과 하행 종점을 찾는다.
            - [x] 노선에 포함된 역들을 그래프에 추가
            - [x] 그래프에 상행 종점과 하행 종점의 경로를 반환하도록 한다.
            - [x] 경로를 역들의 목록으로 변환한다.
          
- [x] 노선에 포함된 역을 순서대로 보여주도록 응답을 개선합니다.
    - [x] (GET /lines/stations)
        - [x] 모든 노선을 조회한다.
        - [x] 조회한 노선의 역들을 순서대로 정렬한다.
        - [x] 역들의 목록으로 반환한다.

### 추가 도메인
LineSections 
- [x] 한 노선의 구역들을 담당한다.
    - [x] 해당 라인의 구역이 비어있는지 확인한다.
    - [x] 해당 라인의 역이 존재하는지 확인한다.
    - [x] 해당 라인의 기준역이 종점인지 확인한다.
    - [x] 해당 라인의 종점들을 반환한다.

AdjacentSection
- [x] 역이 추가되는 한 구역을 담당한다
  - [x] 인접한 두 역과 방향을 받아 해당하는 역을 필드로 가진다.
  - [x] 기준역부터 새 역까지의 거리를 검증한다
  - [x] 구역을 거리를 이용해 새로운 구역 두개로 나눈다